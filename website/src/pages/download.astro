---
import Layout from '../layouts/Layout.astro';
import HeaderNav from '../components/HeaderNav.astro';
import Footer from '../components/Footer.astro';
import Card from '../components/Card';
import CodeBlock from '../components/CodeBlock';
import InviteUrlBuilder from '../components/InviteUrlBuilder';
---

<Layout title="Download - Greatshield">
  <HeaderNav />
  
  <main>
    <section class="container mx-auto px-4 py-16">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl md:text-5xl font-bold text-center mb-8 tracking-wide">
          Install & Run Locally
        </h1>
        <p class="text-lg text-center text-foreground/80 mb-16 max-w-2xl mx-auto">
          Get Greatshield running on your machine in minutes. No cloud services, 
          no external dependencies, complete privacy.
        </p>

        <!-- Installation tabs -->
        <div class="mb-16">
          <div class="flex border-b border-border mb-8" role="tablist">
            <button 
              class="tab-btn active px-6 py-3 font-semibold text-sm uppercase tracking-wide border-b-2 border-accent"
              data-tab="npx"
            >
              NPX (Recommended)
            </button>
            <button 
              class="tab-btn px-6 py-3 font-semibold text-sm uppercase tracking-wide border-b-2 border-transparent hover:border-border"
              data-tab="binary"
            >
              Binary Download
            </button>
          </div>

          <!-- NPX Tab -->
          <div id="npx-tab" class="tab-content">
            <div class="grid md:grid-cols-2 gap-8">
              <Card client:load>
                <h3 class="text-lg font-semibold mb-4 uppercase tracking-wide">
                  Quick Start
                </h3>
                <CodeBlock client:load>npx greatshield</CodeBlock>
                <p class="text-sm text-foreground/70 mt-3">
                  This command will download, install, and run the setup wizard. 
                  Perfect for first-time users who want guided configuration.
                </p>
              </Card>

              <Card client:load>
                <h3 class="text-lg font-semibold mb-4 uppercase tracking-wide">
                  Setup Wizard Flow
                </h3>
                <div class="font-mono text-xs space-y-1 text-foreground/70">
                  <div>$ npx greatshield</div>
                  <div class="text-accent">? Discord Bot Token: ****</div>
                  <div class="text-accent">? Guild ID: 123456789012345678</div>
                  <div class="text-accent">? Policy Pack: [Balanced Moderation]</div>
                  <div class="text-accent">? AI Model: [Phi-2 2.7B - Recommended]</div>
                  <div class="text-accent">? Installing Ollama...</div>
                  <div class="text-accent">? Downloading model...</div>
                  <div>✓ Setup complete! Run 'greatshield start'</div>
                </div>
              </Card>
            </div>
          </div>

          <!-- Binary Tab -->
          <div id="binary-tab" class="tab-content hidden">
            <div class="grid md:grid-cols-3 gap-6">
              <Card client:load>
                <h3 class="text-lg font-semibold mb-4 uppercase tracking-wide">
                  Windows
                </h3>
                <a 
                  href="#" 
                  class="btn-primary rounded-sm inline-block mb-3"
                >
                  Download .exe
                </a>
                <p class="text-xs text-foreground/70">
                  Standalone executable for Windows 10/11. 
                  No Node.js installation required.
                </p>
              </Card>

              <Card client:load>
                <h3 class="text-lg font-semibold mb-4 uppercase tracking-wide">
                  macOS
                </h3>
                <a 
                  href="#" 
                  class="btn-primary rounded-sm inline-block mb-3"
                >
                  Download .app
                </a>
                <p class="text-xs text-foreground/70">
                  Universal binary for Intel and Apple Silicon Macs. 
                  macOS 11.0+ required.
                </p>
              </Card>

              <Card client:load>
                <h3 class="text-lg font-semibold mb-4 uppercase tracking-wide">
                  Linux
                </h3>
                <a 
                  href="#" 
                  class="btn-primary rounded-sm inline-block mb-3"
                >
                  Download Binary
                </a>
                <p class="text-xs text-foreground/70">
                  Static binary for x64 Linux distributions. 
                  Tested on Ubuntu, Debian, CentOS, and Arch.
                </p>
              </Card>
            </div>
          </div>
        </div>

        <!-- Requirements -->
        <Card client:load className="mb-8">
          <h2 class="text-xl font-semibold mb-4 uppercase tracking-wide">
            Requirements
          </h2>
          <div class="grid md:grid-cols-2 gap-6 text-sm">
            <div>
              <h3 class="font-semibold text-accent mb-2">System:</h3>
              <ul class="space-y-1 text-foreground/80">
                <li>• Node.js 20.0+ and npm (for NPX installation)</li>
                <li>• 4GB+ RAM (2GB available for AI models)</li>
                <li>• 10GB+ free disk space (for models and logs)</li>
                <li>• Internet connection for initial setup</li>
              </ul>
            </div>
            <div>
              <h3 class="font-semibold text-accent mb-2">Dependencies:</h3>
              <ul class="space-y-1 text-foreground/80">
                <li>• SQLite (bundled automatically)</li>
                <li>• Ollama (installed during setup)</li>
                <li>• Discord bot with proper permissions</li>
                <li>• Access to target Discord server</li>
              </ul>
            </div>
          </div>
        </Card>

        <!-- Discord Bot Setup -->
        <InviteUrlBuilder client:load />

        <!-- Post-Installation -->
        <Card client:load className="mt-8">
          <h2 class="text-xl font-semibold mb-4 uppercase tracking-wide">
            After Installation
          </h2>
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <h3 class="text-sm font-semibold mb-2 uppercase tracking-wide text-accent">
                Start Monitoring:
              </h3>
              <CodeBlock client:load>
{`# Start the bot
greatshield start

# Check status
greatshield status

# View logs
greatshield logs --follow`}
              </CodeBlock>
            </div>
            <div>
              <h3 class="text-sm font-semibold mb-2 uppercase tracking-wide text-accent">
                Discord Commands:
              </h3>
              <div class="text-sm space-y-1 text-foreground/80">
                <div><code>/guardian status</code> - Check bot health</div>
                <div><code>/guardian appeal</code> - Appeal moderation actions</div>
                <div>Automatic moderation runs in background</div>
                <div>Check your mod-log channel for activity</div>
              </div>
            </div>
          </div>
        </Card>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<script>
  // Simple tab switching functionality
  document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        const targetTab = this.getAttribute('data-tab');
        
        // Update button states
        tabButtons.forEach(btn => {
          btn.classList.remove('active', 'border-accent');
          btn.classList.add('border-transparent');
        });
        this.classList.add('active', 'border-accent');
        this.classList.remove('border-transparent');
        
        // Update content visibility
        tabContents.forEach(content => {
          if (content.id === targetTab + '-tab') {
            content.classList.remove('hidden');
          } else {
            content.classList.add('hidden');
          }
        });
      });
    });
  });
</script>