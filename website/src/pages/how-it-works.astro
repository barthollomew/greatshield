---
import Layout from '../layouts/Layout.astro';
import HeaderNav from '../components/HeaderNav.astro';
import Footer from '../components/Footer.astro';
import Card from '../components/Card';
import FlowDiagram from '../components/FlowDiagram.astro';
import CodeBlock from '../components/CodeBlock';
---

<Layout title="How It Works - Greatshield">
  <HeaderNav />
  
  <main>
    <section class="container mx-auto px-4 py-16">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl md:text-5xl font-bold text-center mb-8 tracking-wide">
          A Radically Simple Workflow
        </h1>
        <p class="text-lg text-center text-foreground/80 mb-16 max-w-2xl mx-auto">
          Three steps to get AI-powered moderation running entirely on your machine.
        </p>

        <!-- Three step cards -->
        <div class="grid md:grid-cols-3 gap-8 mb-16">
          <Card client:load>
            <div class="text-center">
              <h3 class="text-lg font-semibold mb-3 uppercase tracking-wide text-accent">
                1. Install
              </h3>
              <CodeBlock client:load>npx greatshield</CodeBlock>
              <p class="text-sm text-foreground/70 mt-3">
                Single command installation. No complex setup, no configuration files.
              </p>
            </div>
          </Card>

          <Card client:load>
            <div class="text-center">
              <h3 class="text-lg font-semibold mb-3 uppercase tracking-wide text-accent">
                2. Configure
              </h3>
              <p class="text-sm text-foreground/70 mb-3">
                CLI wizard for policy & model; all local
              </p>
              <div class="text-xs font-mono text-foreground/60 space-y-1">
                <div>Discord Bot Token: ****</div>
                <div>Policy Pack: [Balanced]</div>
                <div>AI Model: [Phi-2 2.7B]</div>
                <div>Ollama: [Installing...]</div>
              </div>
            </div>
          </Card>

          <Card client:load>
            <div class="text-center">
              <h3 class="text-lg font-semibold mb-3 uppercase tracking-wide text-accent">
                3. Protect
              </h3>
              <p class="text-sm text-foreground/70 mb-3">
                Moderation in real time via Discord Gateway
              </p>
              <div class="text-xs text-accent">
                ✓ Fast-pass filtering<br/>
                ✓ AI analysis<br/>
                ✓ Action & logging
              </div>
            </div>
          </Card>
        </div>
      </div>
    </section>

    <!-- Under the Hood -->
    <section class="container mx-auto px-4 py-16">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold text-center mb-12 tracking-wide">
          Under the Hood
        </h2>
        
        <FlowDiagram />
        
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mt-12">
          <Card client:load>
            <h3 class="text-lg font-semibold mb-3 uppercase tracking-wide">
              Fast-Pass Filter
            </h3>
            <p class="text-sm text-foreground/80">
              Instant regex-based detection for banned words, spam patterns, 
              and blocked URLs. Catches obvious violations in milliseconds.
            </p>
          </Card>

          <Card client:load>
            <h3 class="text-lg font-semibold mb-3 uppercase tracking-wide">
              RAG Retrieval
            </h3>
            <p class="text-sm text-foreground/80">
              Contextual policy lookup with recent channel messages. 
              Provides AI with relevant rules and conversation history.
            </p>
          </Card>

          <Card client:load>
            <h3 class="text-lg font-semibold mb-3 uppercase tracking-wide">
              Local AI Analysis
            </h3>
            <p class="text-sm text-foreground/80">
              Ollama-powered LLM runs entirely on your hardware. 
              Analyzes toxicity, harassment, spam, and grooming risk.
            </p>
          </Card>

          <Card client:load>
            <h3 class="text-lg font-semibold mb-3 uppercase tracking-wide">
              Smart Actions
            </h3>
            <p class="text-sm text-foreground/80">
              Graduated response system: mask minor issues, 
              delete & warn serious violations, escalate concerning content.
            </p>
          </Card>

          <Card client:load>
            <h3 class="text-lg font-semibold mb-3 uppercase tracking-wide">
              Audit Trail
            </h3>
            <p class="text-sm text-foreground/80">
              Complete logging to SQLite database and Discord mod-log channel. 
              Full transparency with AI reasoning included.
            </p>
          </Card>

          <Card client:load>
            <h3 class="text-lg font-semibold mb-3 uppercase tracking-wide">
              Appeal System
            </h3>
            <p class="text-sm text-foreground/80">
              Built-in slash commands allow users to appeal moderation actions. 
              Human moderators can review and override AI decisions.
            </p>
          </Card>
        </div>
      </div>
    </section>

    <!-- Performance -->
    <section class="container mx-auto px-4 py-16">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold text-center mb-12 tracking-wide">
          Performance Characteristics
        </h2>
        
        <div class="grid md:grid-cols-2 gap-8">
          <Card client:load>
            <h3 class="text-lg font-semibold mb-4 uppercase tracking-wide">
              Fast-Pass Response
            </h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span>Regex Filtering:</span>
                <span class="text-accent">< 1ms</span>
              </div>
              <div class="flex justify-between">
                <span>Spam Detection:</span>
                <span class="text-accent">< 5ms</span>
              </div>
              <div class="flex justify-between">
                <span>URL Checking:</span>
                <span class="text-accent">< 10ms</span>
              </div>
            </div>
          </Card>

          <Card client:load>
            <h3 class="text-lg font-semibold mb-4 uppercase tracking-wide">
              AI Analysis Response
            </h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span>TinyLLaMA 1.1B:</span>
                <span class="text-accent">100-300ms</span>
              </div>
              <div class="flex justify-between">
                <span>Phi-2 2.7B:</span>
                <span class="text-accent">200-500ms</span>
              </div>
              <div class="flex justify-between">
                <span>Mistral 7B:</span>
                <span class="text-accent">500-1500ms</span>
              </div>
            </div>
          </Card>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>